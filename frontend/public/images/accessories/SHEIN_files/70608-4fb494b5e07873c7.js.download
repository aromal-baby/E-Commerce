"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[70608],{570608:(e,t,s)=>{s.d(t,{ZV:()=>W,a:()=>B});var n,r,a,i,o,c,d,u,l,p,h,m,g=s(415690),_=s(444736),k=s(668484),C=s(901974),f=s(111588),y=s(665640),v=Object.defineProperty,b=e=>{throw TypeError(e)},T=(e,t,s)=>((e,t,s)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s),w=(e,t,s)=>t.has(e)||b("Cannot "+s),D=(e,t,s)=>(w(e,t,"read from private field"),s?s.call(e):t.get(e)),E=(e,t,s)=>t.has(e)?b("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),R=(e,t,s)=>(w(e,t,"access private method"),s);const L="17c23d3b-3a89-4011-b8ad-bedde18ec32d",I="cc5d8b93-c0d5-491d-8bd8-22b2ca2f493c",S="en_US";n=new WeakMap,r=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakSet,l=function({sdkName:e,type:t,overwriteAttr:s}){const o=D(this,n)[e]||D(this,r)[e],c=D(this,a)[e];if("fulfilled"===c)return Promise.resolve(!0);if(D(this,i)[e]&&"pending"===c)return D(this,i)[e];D(this,a)[e]="pending";const d=(({sdkName:e,type:t,sdk:s,overwriteAttr:n={}})=>"style"===t?{label:"link",attrs:{rel:"stylesheet",href:s,id:`channel-${e}`,async:"async"}}:{label:"script",attrs:{src:s,id:`channel-${e}`,async:"async",...n||{}}})({sdkName:e,type:t,sdk:o,overwriteAttr:s});return D(this,i)[e]=(0,g.t)(d)},p=function(e){return e.every((e=>"fulfilled"===D(this,a)[e]))},h=function(e){return Promise.allSettled(e.map((e=>R(this,u,l).call(this,{sdkName:e.sdkName||e,type:(null==e?void 0:e.type)||"script",overwriteAttr:(null==e?void 0:e.overwriteAttr)||{}}))))},m=async function(e){if(R(this,u,p).call(this,e))return{datas:!0};return(await R(this,u,h).call(this,e)).forEach(((t,s)=>{D(this,a)[e[s]]=t.status})),{datas:!0}};const N=["bg_BG","cs_CZ","da_DK","de_AT","de_BE","de_CH","de_DE","el_GR","en_AE","en_AU","en_BE","en_BH","en_CA","en_CH","en_CZ","en_DE","en_EG","en_ES","en_GB","en_HK","en_HR","en_IE","en_IL","en_IN","en_IT","en_JO","en_KE","en_KW","en_NG","en_NO","en_NZ","en_PH","en_PL","en_QA","en_RS","en_SA","en_SE","en_SG","en_TH","en_TZ","en_US","en_VN","es_AR","es_CL","es_CO","es_DO","es_EC","es_ES","es_GT","es_HN","es_MX","es_NI","es_PA","es_PE","es_PY","es_SV","es_UY","et_EE","fi_FI","fr_BE","fr_CA","fr_CH","fr_FR","hu_HU","hr_HR","it_CH","it_IT","lt_LT","lv_LV","ms_MY","nb_NO","nl_BE","nl_NL","pl_PL","pt_BR","pt_PT","ro_RO","sk_SK","sr_RS","sv_SE","sv_FI","th_TH","uk_UA","vi_VN","zh_HK","zh_SG"],O=e=>{var t;if(!e||!(null==e?void 0:e.length))return[];const s=(null==(t=null==e?void 0:e.map)?void 0:t.call(e,(e=>({...e,id:e.srcDigitalCardId||"",card_bin:(null==e?void 0:e.panBin)||"",last_four_no:e.panLastFour||"",card_no:e.panLastFour?`****${e.panLastFour||""}`:"",app_logo:e.digitalCardData.artUri,web_logo:e.digitalCardData.artUri,card_type:e.paymentCardDescriptor||"",srcDigitalCardId:e.srcDigitalCardId||"",status:e.digitalCardData.status}))))||[],n=[],r=[];for(let e=0;e<s.length;e++)"ACTIVE"===s[e].status?n.push(s[e]):r.push(s[e]);return[...n,...r]},x=e=>{if(!e)return{status:"fail",fail_tips:"Checkout failed"};const{checkoutActionCode:t="",checkoutResponseData:s,headers:n}=e||{};let r="error",a={},i="";return"COMPLETE"===t&&(r="success",a={srcFlowId:(null==n?void 0:n["x-src-cx-flow-id"])||"",correlationId:(null==s?void 0:s.srcCorrelationId)||"",merchantTransactionId:(null==n?void 0:n["merchant-transaction-id"])||"",tokenList:O((null==s?void 0:s.maskedCard)?[null==s?void 0:s.maskedCard]:[])},i=""),"CANCEL"===t&&(r="cancel",i="Checkout canceled"),"ERROR"===t&&(r="fail",i="Checkout failed"),{status:r,fail_tips:i,data:a,originData:e}};const P={srcDpaId:"",cardBrands:["mastercard","visa","amex","discover"],dpaData:{dpaName:"SHEIN",dpaPresentationName:"SHEIN"},dpaTransactionOptions:{dpaAcceptedBillingCountries:[],dpaAcceptedShippingCountries:[],dpaBillingPreference:"NONE",dpaShippingPreference:"NONE",dpaLocale:"en_US",consumerNameRequested:!1,consumerEmailAddressRequested:!1,consumerPhoneNumberRequested:!1,threeDsPreference:"NONE",paymentOptions:[{dpaDynamicDataTtlMinutes:15,dynamicDataType:"NONE"}],transactionAmount:{transactionAmount:0,transactionCurrencyCode:"USD"},confirmPayment:!1},checkoutExperience:"WITHIN_CHECKOUT"},A=15552e3,V="recognitionToken",M=["mastercard","visa","discover","amex"];class W{constructor(){T(this,"c2pCheckoutInstance"),T(this,"appConfigs"),T(this,"traceId"),T(this,"initParams"),T(this,"getDefaulParams",(()=>({...P}))),T(this,"commonResponse",(e=>({status:(null==e?void 0:e.status)||"error",message:(null==e?void 0:e.message)||"",info:(null==e?void 0:e.info)||null,errorDetails:(null==e?void 0:e.errorDetails)||null}))),T(this,"formatC2pError",(e=>{try{return{name:(null==e?void 0:e.name)||"C2PError",reason:null==e?void 0:e.reason,details:null==e?void 0:e.details,message:null==e?void 0:e.message}}catch(e){return{}}})),T(this,"_checkInit",(()=>{if("undefined"==typeof window||"undefined"==typeof MastercardCheckoutServices)throw new Error("MastercardCheckoutServices is not defined");return!!this.c2pCheckoutInstance})),T(this,"init",(async e=>{var t,s;try{if("undefined"==typeof window)return this.commonResponse();if("undefined"==typeof MastercardCheckoutServices)return this.commonResponse({status:"error",message:"MastercardCheckoutServices is not defined"});this.c2pCheckoutInstance=new MastercardCheckoutServices,window.__c2pCheckoutService__=this.c2pCheckoutInstance;const n=(0,_.R)(V)||"",r=["localhost","debug"].includes(null==(s=null==(t=this.appConfigs)?void 0:t.$envs)?void 0:s.NODE_SERVER_ENV),a={...this.initParams,srcDpaId:r?L:I,cardBrands:M};n&&(a.recognitionToken=n),e.dpaLocale&&N.includes(e.dpaLocale)&&a.dpaTransactionOptions&&(a.dpaTransactionOptions.dpaLocale=e.dpaLocale),e.amount&&e.currencyCode&&a.dpaTransactionOptions&&(a.dpaTransactionOptions.transactionAmount={transactionAmount:e.amount,transactionCurrencyCode:e.currencyCode}),Array.isArray(e.cardBrands)&&(a.cardBrands=e.cardBrands),e.dpaName&&(a.dpaData.dpaName=e.dpaName),e.dpaPresentationName&&(a.dpaData.dpaPresentationName=e.dpaPresentationName),this.initParams=a,this.debuggerLog("init==parameters===",a);const i=await this.c2pCheckoutInstance.init(a);return this.debuggerLog("init==response===",i),{status:"success",message:"init success",info:i,extraData:{parameters:a}}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("init==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t})}})),T(this,"getCards",(async()=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});const e=await this.c2pCheckoutInstance.getCards();return this.debuggerLog("getCards==response===",e),{status:"success",message:"get cards success",info:O(e)}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("getCards==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t,info:[]})}})),T(this,"idLookup",(async e=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});const t={};if(e.email)t.email=e.email;else{if(!e.phone||!e.area_code)return this.commonResponse({status:"error",message:"email or phone is required"});t.mobileNumber={countryCode:e.area_code,phoneNumber:e.phone}}this.debuggerLog("idLookup==parameters===",{parameters:e,params:t});const s=await this.c2pCheckoutInstance.idLookup(t);return this.debuggerLog("idLookup==response===",s),{status:"success",message:"id lookup success",info:{consumerPresent:!!s.consumerPresent}}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("idLookup==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t})}})),T(this,"initiateValidation",(async e=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});this.debuggerLog("initiateValidation==parameters===",e);const t=await this.c2pCheckoutInstance.initiateValidation(e);return this.debuggerLog("initiateValidation==response===",t),{status:"success",message:"initiate validation success",info:t}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("initiateValidation==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t})}})),T(this,"validate",(async e=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});this.debuggerLog("validate==parameters===",e);const t=await this.c2pCheckoutInstance.validate(e);return this.debuggerLog("validate==response===",t),{status:"success",message:"validate success",info:O(t)}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("validate==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t,info:[]})}})),T(this,"completeValidation",(async e=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});this.debuggerLog("completeValidation==parameters===",e);const t=await this.c2pCheckoutInstance.completeValidation(e);return this.debuggerLog("completeValidation==response===",t),(null==t?void 0:t.recognitionToken)&&(0,k.T)({key:V,value:t.recognitionToken,end:A}),{status:"success",message:"complete validation success",info:{recognitionToken:(null==t?void 0:t.recognitionToken)||"",cards:O((null==t?void 0:t.cards)||[])}}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("completeValidation==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t})}})),T(this,"encryptCard",(async e=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});this.debuggerLog("encryptCard==parameters===",e);const t=await this.c2pCheckoutInstance.encryptCard(e);return this.debuggerLog("encryptCard==response===",t),{status:"success",message:"encrypt card success",info:t}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("encryptCard==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t})}})),T(this,"checkoutWithNewCard",(async e=>{var t,s;try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});const n={privacy:{acceptedVersion:"LATEST",latestVersion:"LATEST",latestVersionUri:"https://www.mastercard.com/global/click-to-pay/country-listing/privacy.html"},tnc:{acceptedVersion:"LATEST",latestVersion:"LATEST",latestVersionUri:"https://www.mastercard.com/global/click-to-pay/country-listing/terms.html"},cookie:{acceptedVersion:"LATEST",latestVersion:"LATEST",latestVersionUri:"https://www.mastercard.com/global/click-to-pay/en-us/privacy-notice.html"}},r={encryptedCard:e.encryptedCard||"",cardBrand:e.cardBrand||"",windowRef:e.windowRef,rememberMe:e.rememberMe,recognitionTokenRequested:e.recognitionTokenRequested,checkoutExperience:this.initParams.checkoutExperience,dpaTransactionOptions:Object.assign({},{paymentOptions:null==(t=this.initParams.dpaTransactionOptions)?void 0:t.paymentOptions}),complianceSettings:n},a=["mastercard"];(null==(s=r.dpaTransactionOptions)?void 0:s.paymentOptions)&&a.includes(r.cardBrand)&&(r.dpaTransactionOptions.paymentOptions=[{dpaDynamicDataTtlMinutes:15,dynamicDataType:"CARD_APPLICATION_CRYPTOGRAM_SHORT_FORM"}]),e.email&&(r.consumer||(r.consumer={}),r.consumer.emailAddress=e.email),e.phone&&e.area_code&&(r.consumer||(r.consumer={}),r.consumer.mobileNumber={countryCode:e.area_code,phoneNumber:e.phone}),null!=e.amount&&e.currency&&r.dpaTransactionOptions&&(r.dpaTransactionOptions.transactionAmount={transactionAmount:e.amount,transactionCurrencyCode:e.currency}),this.debuggerLog("checkoutWithNewCard==parameters===",{parameters:e,params:r});const i=await this.c2pCheckoutInstance.checkoutWithNewCard(r),{status:o,data:c,originData:d,fail_tips:u}=x(i);return this.debuggerLog("checkoutWithNewCard==response===",i),r.recognitionTokenRequested&&(null==i?void 0:i.recognitionToken)&&((0,k.T)({key:V,value:i.recognitionToken,end:A}),this.debuggerLog("checkoutWithNewCard==recognitionToken==setCookie===",i.recognitionToken)),{status:o,message:u||"checkout with new card success",info:{data:c,originData:d}}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("checkoutWithNewCard==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t,info:{data:{}}})}})),T(this,"checkoutWithCard",(async e=>{var t,s;try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});const n={srcDigitalCardId:e.srcDigitalCardId,windowRef:e.windowRef,rememberMe:e.rememberMe,recognitionTokenRequested:e.recognitionTokenRequested,checkoutExperience:this.initParams.checkoutExperience,dpaTransactionOptions:Object.assign({},{paymentOptions:null==(t=this.initParams.dpaTransactionOptions)?void 0:t.paymentOptions})},r=["mastercard"];(null==(s=n.dpaTransactionOptions)?void 0:s.paymentOptions)&&r.includes(e.cardBrand||"")&&(n.dpaTransactionOptions.paymentOptions=[{dpaDynamicDataTtlMinutes:15,dynamicDataType:"CARD_APPLICATION_CRYPTOGRAM_SHORT_FORM"}]),null!=!e.amount&&e.currency&&n.dpaTransactionOptions&&(n.dpaTransactionOptions.transactionAmount={transactionAmount:e.amount,transactionCurrencyCode:e.currency}),this.debuggerLog("checkoutWithCard==parameters===",{parameters:e,params:n});const a=await this.c2pCheckoutInstance.checkoutWithCard(n),{status:i,data:o,originData:c,fail_tips:d}=x(a);return this.debuggerLog("checkoutWithCard==response===",a),n.recognitionTokenRequested&&(null==a?void 0:a.recognitionToken)&&((0,k.T)({key:V,value:a.recognitionToken,end:A}),this.debuggerLog("checkoutWithCard==recognitionToken==setCookie===",a.recognitionToken)),{status:i,message:d||"checkout with card success",info:{data:o,originData:c}}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("checkoutWithCard==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t,info:{data:{}}})}})),T(this,"signOut",(async()=>{try{if(!this._checkInit())return this.commonResponse({status:"error",message:"C2P SDK is not initialized"});const e=(0,_.R)(V)||"",t=await this.c2pCheckoutInstance.signOut(e?{recognitionToken:e}:void 0);this.debuggerLog("signOut==response===",t,{recognitionToken:e});const s=t.recognized;return t.recognized||(0,C.z)({key:V}),this.c2pCheckoutInstance=null,{status:"success",message:s?"sign out errors occurred":"sign out success",info:{unbindSucccess:!s,tokenList:O(null==t?void 0:t.cards)||[],originData:t}}}catch(e){const t=this.formatC2pError(e);return this.debuggerLog("signOut==error===",t),this.commonResponse({status:"error",message:(null==t?void 0:t.message)||(null==t?void 0:t.reason),errorDetails:t})}})),this.traceId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),this.c2pCheckoutInstance=null,this.appConfigs=(0,f._t)(),this.initParams=this.getDefaulParams()}get isSandBox(){var e,t;return["localhost","debug"].includes(null==(t=null==(e=this.appConfigs)?void 0:e.$envs)?void 0:t.NODE_SERVER_ENV)}debuggerLog(...e){var t;if("undefined"!=typeof window)try{if(!(null==(t=null==sessionStorage?void 0:sessionStorage.getItem)?void 0:t.call(sessionStorage,"__bs__enable_debug_log")))return;y.info("%cC2P Pay Libs Debug Info:","background:#35495e ; padding: 3px 3px; border-radius: 3px;  color: #fff",...e,"\n")}catch(t){y.log(...e)}}}const B=new class{constructor(){E(this,u),E(this,n,{"sandbox-c2p":`https://sandbox.src.mastercard.com/srci/integration/2/lib.js?srcDpaId=${L}&locale=${S}`,c2p:`https://src.mastercard.com/srci/integration/2/lib.js?srcDpaId=${I}&locale=${S}`,"c2p-ui-kit":"https://src.mastercard.com/srci/integration/components/src-ui-kit/src-ui-kit.esm.js"}),E(this,r,{"c2p-ui-kit-style":"https://src.mastercard.com/srci/integration/components/src-ui-kit/src-ui-kit.css"}),E(this,a,{}),E(this,i,{}),E(this,o,["c2p"]),E(this,c,["sandbox-c2p"]),E(this,d,[{sdkName:"c2p-ui-kit",type:"javascript",overwriteAttr:{type:"module",async:!1}},{sdkName:"c2p-ui-kit-style",type:"style"}])}async initC2pSdk(e){return await R(this,u,m).call(this,(null==e?void 0:e.isSandBox)?D(this,c):D(this,o))}async initC2pUIKit(){return await R(this,u,m).call(this,D(this,d))}}}}]);
//# sourceMappingURL=70608-4fb494b5e07873c7.js.map