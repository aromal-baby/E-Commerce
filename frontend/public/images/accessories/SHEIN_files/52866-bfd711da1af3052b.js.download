"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[52866],{88685:(t,e,i)=>{i.d(e,{Uo:()=>r.Uo,rC:()=>r.rC});var r=i(929819)},92525:(t,e,i)=>{i.r(e),i.d(e,{default:()=>ct});var r=i(444736),s=i(290165),o=i(383112);class a{static for({key:t}){return new(a.classes.find((e=>e.canHandle(t))))({key:t})}static canHandle(t){return!0}constructor({key:t}){this.key=t,this.cache=new Map}get(){return(0,s.getSessionStorage)(this.key)}set(t,e){(0,s.setSessionStorage)({key:this.key,value:t})}getSync(){return(0,s.getSessionStorage)(this.key)}clearStorage(){(0,s.removeSessionStorage)(this.key)}isLogin(){return!!(0,r.R)("memberId")}getMemberId(){return(0,r.R)("memberId")||""}async getIpCountryApi(){try{let t=await(0,o.A)({method:"POST",useBffApi:!0,url:"/user-api/address/update_country"});if(0==t.code){const{countryId:e="",countryAbbr:i=""}=(null==t?void 0:t.info)||{};return{countryId:e,countryAbbr:i}}return{}}catch(t){return{}}}async getUgidApi(){try{var t;const e=await(0,o.A)({method:"get",useBffApi:!0,url:"/user-api/common/userinfo_ugid"});return(null==e||null===(t=e.info)||void 0===t?void 0:t.ugid)||""}catch(t){return""}}}const n=a;var l=i(597874),c=i(665640);function u(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}let d=0,h=!1;const g=[],p=t=>{if(!g.length)return h=!1,!1;g.forEach((e=>{e(t)})),g.splice(0,g.length),h=!1},m="ipCountry";var f=new WeakSet;function v(){if("undefined"==typeof window)return!1;const t=window.localStorage.getItem(m),e=t?JSON.parse(t):{};null!=e&&e.end&&Date.now()>(null==e?void 0:e.end)-18e5&&this.update()}function y(){const t=(0,s.getLocalStorage)(m);return null!=t&&t.countryId?t:{}}const _=class extends n{constructor(...t){super(...t),(0,l.A)(this,f)}static canHandle(t){return"Country"===t}async get(t){if((null==t?void 0:t.reset)||!1){const t=await this.update();if(t.countryId)return t}const e=u(f,this,y).call(this);if(null!=e&&e.countryId)return u(f,this,v).call(this),e;return await this.update()}getSync(t){const e=u(f,this,y).call(this);return null!=e&&e.countryId&&u(f,this,v).call(this),e}set(t){if(null==t||!t.countryId||null==t||!t.countryAbbr)return c.error("missing parameter on set Country method"),!1;(0,s.setLocalStorage)({key:m,value:t,expire:2592e5})}clearStorage(){(0,s.removeLocalStorage)(m)}async update(){return new Promise((t=>{if(d>0&&Date.now()-d<2e4)return t(u(f,this,y).call(this)),!1;if(h)g.push((e=>{t(e)}));else{h=!0;const e=()=>{const e={countryId:"",countryAbbr:"",formatCountryAbbr:""};t(e),p(e)};this.getIpCountryApi().then((i=>{if(null==i||!i.countryId)return e(),!1;const r=(t=>{let e=t;return["SA","AE","KW","IL","JO","QA","OM","AR"].indexOf(t.toUpperCase())>-1?e="ar":(t=>["IN","IND"].indexOf(t.toUpperCase())>-1)(t)&&(e="in"),e})(i.countryAbbr),s={countryId:null==i?void 0:i.countryId,countryAbbr:null==i?void 0:i.countryAbbr,formatCountryAbbr:r};this.set(s),null!=s&&s.countryId&&(d=Date.now()),t(s),p(s)})).catch((t=>{c.error("UserKey.Country.update.error",t),e()}))}}))}};var I=i(794103);class w extends n{static canHandle(t){return"location"===t}async get(){let t=(0,s.getLocalStorage)("location")||"";return"Null"==t?"":(t||(t=await this.getServiceCache()),t||"")}getSync(){let t=(0,s.getLocalStorage)("location");return t||""}async set(t){const e=await this.setSerivceCache(t);"0"==(null==e?void 0:e.code)&&(0,s.setLocalStorage)({key:"location",value:t})}async setSerivceCache(t){const e={key:"location",actionType:"Location/setLocation",value:t};return await(0,o.A)({url:"/api/common/userInfoManager/update",method:"POST",data:e})}async getServiceCache(){const t=await(0,o.A)({url:"/api/common/userInfoManager/get",method:"GET",params:{key:"location",actionType:"Location/getLocation"}});if("0"==(null==t?void 0:t.code))return(0,s.setLocalStorage)({key:"location",value:(null==t?void 0:t.data)||"Null"}),(null==t?void 0:t.data)||""}}(0,I.A)(w,"cacheQue",[]);const b=w,{SUPPORT_LANGS:k,lang:S}=gbCommonInfo;const A=class extends n{static canHandle(t){return"language"===t}get(){let t=k[0]||S,e=(0,r.R)("language");return e&&k.includes(e)&&(t=e),t}async set(t,{}={}){return await(0,o.A)({url:"/api/common/language/update",params:{new_lang:t}}),t}};const R=class extends n{static canHandle(t){return"memberId"===t}get(){return(0,r.R)(this.key)||""}};var C=i(246752),E=i(665640);const T="userinfo_email";const L=class extends n{static canHandle(t){return t===T}getStorageUserinfoEmail(){let t="";try{let e=this.initStoreCacheKey();t=(0,s.getLocalStorage)(e)||""}catch(e){E.log("UserInfoManage Get UserEmail Error",e),t=""}return t}clearStorageUserinfoEmail(){try{let t=Object.keys(localStorage||{});t=t.filter((t=>t.includes(T))),t.length&&t.forEach((t=>(0,s.removeLocalStorage)(t)))}catch(t){E.log("clear localStorage error",t)}}initStoreCacheKey(){return`${this.getMemberId()}_${T}`}async get(){if(!this.isLogin())return this.clearStorageUserinfoEmail(),"";let t=this.getStorageUserinfoEmail();if(t)return t;let{data:e="",code:i=""}=await this.getServiceUserinfoEmail();if("0"===i){if(this.clearStorageUserinfoEmail(),e){let t=this.initStoreCacheKey();(0,s.setLocalStorage)({key:t,value:e,expire:36e5})}return e||""}return C.A.report({apiPath:"get/user-email/error",errorSubType:"get_user_email",errorType:"get_user_email_error",error_scene:"get_user_email_default"}),(0,r.R)(T)||""}getSync(){if(!this.isLogin())return this.clearStorageUserinfoEmail(),"";let t=this.getStorageUserinfoEmail();return t||((0,r.R)(T)||"")}async getServiceUserinfoEmail(){return await(0,o.A)({url:"/api/common/userInfoManager/get",params:{key:T,actionType:"getServiceUserInfoEmail"}})||{}}};var D=i(668484),P=i(579308),N=i(665640);const{default_currency:x,currencies:O}=gbCommonInfo,j="currency",U=Object.keys(O||{});let G=!1;const J=class extends n{static canHandle(t){return"currency"===t}get(){let t=x,e=(0,r.R)(j);e&&U.includes(e)&&(t=e);const i=(0,P.e)({key:"currency"});if(i&&"0"!=i&&gbCommonInfo.currency==i&&!G&&i!=t){const e=2592e3;t=i,(0,D.T)({key:j,value:t,curMainDomain:!0,end:e}),N.log("fix cdn query currency cookie")}return G=!0,t}async set(t,{isLog:e=0}={}){let i={currency:t};return 1==e&&Object.assign(i,{isLog:1,gbCur:gbCommonInfo.currency}),await(0,o.A)({url:"/api/common/currency/update",params:i}),t}};var $=i(236762);const H=$.mz,q=15552e5,M=["AuthToken","login_phone","phone","area_code","modifyPassword","account_type","add_time","login_time_last","member_id","nickname","init_password"];const K=class extends n{static canHandle(t){return"UserInfo"===t}async getAuthUserInfo(){const t=await(0,o.A)({url:"/user-api/account/query_user_info",useBffApi:!0}),{code:e,info:i}=t||{};return 0==e?(i.account_type=parseInt(null==i?void 0:i.account_type),i.add_time=parseInt(null==i?void 0:i.add_time),i.login_time_last=parseInt(null==i?void 0:i.login_time_last),i||{}):{}}isNotEmpty(t){return"object"==typeof t&&null!=t&&Object.keys(t).length>0}filterObjectByKeys(t,e){return e.reduce(((e,i)=>void 0!==t[i]?{...e,[i]:t[i]}:e),{})}async get(t={}){const e=(null==t?void 0:t.noCache)||!1;if(!this.isLogin()&&!0!==e)return(0,s.removeLocalStorage)(H),{};let i={};return!0!==e&&(i=(0,s.getLocalStorage)(H)||{}),this.isNotEmpty(i)||(i=await this.getAuthUserInfo(),this.isNotEmpty(i)&&(0,s.setLocalStorage)({key:H,value:this.filterObjectByKeys(i||{},M),expire:q})),i}set(t,{}={}){const e=this.filterObjectByKeys(t||{},M);this.isNotEmpty(e)&&(0,s.setLocalStorage)({key:H,value:e,expire:q})}getSync(){if(!this.isLogin())return(0,s.removeLocalStorage)(H),{};return(0,s.getLocalStorage)(H)||{}}};let F=null,V=null,B=!1;const z=class extends n{static canHandle(t){return"ugid"===t}async get(){if(B)return this.getSync();F||(F=function(t,e){return Promise.race([t,new Promise((t=>setTimeout((()=>t(null)),e)))])}(this.getUgidApi(),5e3));const t=await F;return this.set(t),t}getSync(){return V}set(t=""){B=!0,V=t}clearStorage(){B=!1,V=null,F=null}};var W=i(901974);const Y="webpushcookie";const X=class extends n{static canHandle(t){return t===Y}async get(){return(0,r.R)(Y)}set(t=""){(0,D.T)({key:Y,value:`agree:${t}`,end:31536e3})}clearStorage(){(0,W.z)({key:Y})}};var Z=i(721720);const Q=class extends n{static canHandle(t){return"oest"===t}get(){return Z.Lw.get()}set(){}},tt="is_paid_member";const et=class extends n{static canHandle(t){return"isPaid"===t}async getPrimeInfo(){const t=await(0,o.A)({url:"/user-api/prime/info",useBffApi:!0}),{code:e,info:i}=t||{};return 0==e&&i||{}}isNotEmpty(t){return"object"==typeof t&&null!=t&&Object.keys(t).length>0}async get(t={}){const e=(null==t?void 0:t.noCache)||!1;if(!this.isLogin())return(0,s.removeLocalStorage)(tt),{};let i={};return!0!==e&&(i=(0,s.getLocalStorage)(tt)||{}),this.isNotEmpty(i)||(i=await this.getPrimeInfo(),this.isNotEmpty(i)&&(0,s.setLocalStorage)({key:tt,value:i,expire:3e5})),i}};var it=i(315849),rt=i(818356);const{SiteUID:st}="undefined"!=typeof gbCommonInfo?gbCommonInfo:{},ot="addressCookie",at=[{idKey:"stateId",valueKey:"state"},{idKey:"cityId",valueKey:"city"},{idKey:"districtId",valueKey:"district"},{idKey:"countryId",valueKey:"countryName"}];const nt=class extends n{static canHandle(t){return"address"===t}async get(){let t=(0,s.getLocalStorage)(ot)||{};const e=(0,s.getLocalStorage)("address_cache")||{};at.forEach((({idKey:i,valueKey:r})=>{const s=t[i];s&&e[s]&&(t[r]=e[s])}));const i=this.getMemberId();var r;return(!t||0===Object.keys(t).length||(r=t,i&&(null==r?void 0:r.memberId)!=i||(null==r?void 0:r.siteUid)!==st))&&(t=await this.getServiceAddressCache()),t}async getServiceAddressCache(){const{data:t={},code:e=""}=await(0,o.A)({url:"/api/common/userInfoManager/get",method:"GET",params:{key:"address",actionType:"User/getUserAddress"}});return"0"===e?(t&&(0,s.setLocalStorage)({key:ot,value:t}),t):{}}async set(t){const{code:e=""}=await this.setSerivceAddressCache(t);"0"===e&&((0,s.setLocalStorage)({key:ot,value:t}),(0,it.x)({keys:["dynamicData","addressbook","addressbook-post"]}))}async setSerivceAddressCache(t){0!==Object.keys(t).length&&(t.addrFromFlag=(null==t?void 0:t.addrFromFlag)||"1",t.memberId=(null==t?void 0:t.memberId)||this.getMemberId()||"",t.siteUid=(null==t?void 0:t.siteUid)||st||""),(0,rt.A)({message:"x address flag record from userinfoManager set",userMemberId:this.getMemberId()||"",userSiteUid:st||"",setMemberId:(null==t?void 0:t.memberId)||"",setSiteUid:(null==t?void 0:t.siteUid)||""});const e={key:"address",actionType:"User/setUserAddress",value:t};return await(0,o.A)({method:"POST",url:"/api/common/userInfoManager/update",data:e})}};n.classes=[_,b,A,R,L,J,K,z,X,Q,et,nt];class lt{static get({key:t,options:e,actionType:i=""}){return lt.getActionLists.add(i),n.for({key:t}).get(e)}static set({key:t,value:e,options:i={},actionType:r=""}){return lt.setActionLists.add(r),n.for({key:t}).set(e,i)}static getSync({key:t,options:e,actionType:i=""}){return lt.getActionLists.add(i),n.for({key:t}).getSync(e)}static isLogin(){return!!(0,r.R)("memberId")}static switchLanguge(){}static clearStorage({key:t}){n.for({key:t}).clearStorage()}static clearAllStorage(){["Country","language","memberId","userinfo_email","pwa_user_email","ugid"].forEach((t=>{lt.clearStorage({key:t})}))}}lt.getActionLists=new Set,lt.setActionLists=new Set;const ct=lt},177279:(t,e,i)=>{i.d(e,{Vc:()=>n,JY:()=>l,Ay:()=>a,cA:()=>c});var r=i(518295),s=i(444736);var o=i(665640);if("undefined"!=typeof window){const{PUBLIC_CDN:t,SERVER_TYPE:e,NODE_SERVER_ENV:a,IS_RW:n,SiteUID:l,appLanguage:c,currency:u}=gbCommonInfo;i.p=`${t}/she_dist/assets/`,r.h.init({server_type:"usa"===e?"us":e,brand:n?"romwe":"shein",device_type:"pc",language:c,currency:u,env:"production"===a?"production":"debug",site_uid:l}),r.h.registerField({member_id:function(){if("undefined"==typeof window)return"";let t=(0,s.R)("memberId");try{if(t)return t;const e=localStorage.getItem("auth_member")||"null";return(JSON.parse(e)||{value:{}}).value.member_id||""}catch(t){return""}},params(){var t;return{server_from:"aidc-web-pc",page_name:(null===(t=window.SaPageInfo)||void 0===t?void 0:t.page_name)||"other"}}});const d={cache:{loop_time:5e3},record_when_page_hidden:!0};if("localhost"===a){const t="1"==sessionStorage.getItem("skynet_fetch"),e="1"==sessionStorage.getItem("skynet_log");t||(d.http={generator:()=>t=>{var i;e&&o.log("@@@@@@@@@@@@@@@@@",t.url.replace(/.*\/app-track\//,""),null==t||null===(i=t.data)||void 0===i?void 0:i.data,"@@@@@@@@@@@@@@@@@")}})}r.h.config(d),(t=>{const{ERROR_JS_SWITCH_OLD_ON:e}=gbCommonInfo;if(!t||1==e)return;const i=function(e){const i=e.tag||e.errorMark||e.type||e.errorType;t.SILogger.logInfo({tag:i,message:i,params:e})},r=function(e){const{metricName:i,...r}=e;t.SIMetric.metricCount({metric_name:i,tags:r})};if(window.ErrorJs){var s,o,a,n,l,c;if(null!==(s=window.ErrorJs)&&void 0!==s&&null!==(o=s.log_proxy)&&void 0!==o&&null!==(a=o.queues)&&void 0!==a&&a.length)for(;window.ErrorJs.log_proxy.queues.length;){const t=window.ErrorJs.log_proxy.queues.shift();i(t)}if(null!==(n=window.ErrorJs)&&void 0!==n&&null!==(l=n.monitor_proxy)&&void 0!==l&&null!==(c=l.queues)&&void 0!==c&&c.length)for(;window.ErrorJs.monitor_proxy.queues.length;){const t=window.ErrorJs.monitor_proxy.queues.shift();r(t)}window.ErrorJs.log_proxy=i,window.ErrorJs.monitor_proxy=r}else window.ErrorJs={sendError:function(t,e,s){if(e.indexOf("/unusual")>-1)return s.reportList&&s.reportList.forEach((function(t){t.metricName&&r(t)})),void i(s);window.sa&&(window.sa(t,e,s),i(Object.assign(s,{tag:"error-js-report-other"})))}}})(r.h),window.SILog=window.SILog||r.h}const a=r.h,n=r.h.SILogger,l=r.h.SIMetric;function c(t){"undefined"!=typeof window&&window.monitorLight&&(t.config.errorHandler=window.monitorLight.vueErrorHandler)}},236762:(t,e,i)=>{i.d(e,{CC:()=>r,Wb:()=>o,mz:()=>s});const r="disableAutoSelect",s="auth_member",o="ajhjkjalh778ah3kjnksSDHJsaAFkjr432jsa"},246752:(t,e,i)=>{i.d(e,{A:()=>p});const r={"/api/cart/add_mall/create":{all:!0},"/api/cart/update_attr_mall/update":{all:!0},"/api/user/wishlist/add":{all:!0},"/api/checkout/paymentList/get":{all:!1,excludes:["card_no","card_pin"]},"/checkout/cacu_total":{all:!0},"/api/checkout/order/update":{all:!1,includes:["editType"]},"/checkout/switch_payment":{all:!0},"/ltspc/pay/unPay/unifiedPay":{all:!1,includes:["billno","paymentCode","routeId"]},"/ltspc/pay/binCheck":{all:!0},"/ltspc/pay/preRouting":{all:!0},"ltspc/pay/unPay/complete":{all:!0}},s=[{path:/^\/user\/orders\/detail\/\w+/,all:!0}];var o=i(665640);const a=[];let n="";const l=[],c=[/^\/(api\/)?(cart|user|checkout|getCouponListForOrderStore|getCouponListForOrder|pay|ltspc)/],u=["language","theme"],d=[0,1e3,-1,200],{NODE_SERVER_ENV:h,langPath:g}=gbCommonInfo;const p=new class{isFilterRoute(t){const e=t&&t.url&&t.url.split("?")[0];return l.includes(e)}isIncluseRoutes(t){const e=t;return c.some((t=>t.test(e)))}isReportCode(t={},e){const i=t&&Object.prototype.hasOwnProperty.call(t,"code")?t.code:"undefined";return"undefined"===i?e&&200!=e.status:!d.includes(parseInt(i,10))}isFilterEnvs(){return a.includes(h)}isFilterArea(t){return u.includes(t)}transformResponse(t){let e={};try{t.responseType&&"json"==t.responseType?e=t.response||t.responseJson:t.responseText&&(e=JSON.parse(t.responseText))}catch(e){o.log(t),o.log(e)}return e}parseString(t){try{return JSON.stringify(t)}catch(t){return""}}formatReportParams(t,e={},i,r={}){return"object"==typeof e&&Object.keys(e).forEach((i=>{this.isFilterArea(i)||("object"==typeof e[i]?t[i]=this.parseString(e[i]):t[i]=e[i])})),t=this.addRequstParams(t,i,r)}parseRequestParams(t,e=""){if("[object Object]"==Object.prototype.toString.call(t))return t;let i=Object.create(null);if("[object String]"==Object.prototype.toString.call(t)){if(e.includes("application/json")){try{i=JSON.parse(t)}catch(t){}return i}if(!(t=t.trim().replace(/^(\?|#|&)/,"")))return i;t.split("&").forEach((function(t){let e=t.replace(/\+/g," ").split("="),r=e.shift(),s=e.length>0?e.join("="):void 0;if(r=decodeURIComponent(r),r.endsWith("[]")&&(r=r.slice(0,-2)),void 0===s)s=null;else try{s=decodeURIComponent(s)}catch(t){}void 0===i[r]?i[r]=s:Array.isArray(i[r])?i[r].push(s):i[r]=[i[r],s]}))}return i}getRequestData(t,e){return"GET"==e.type?t.apiSearch||"":e.data||null}getNeedParsePath(t){const{apiPath:e}=t;let i={};if(r[e])return i=r[e],{isNeed:!0,pathConfig:i};const o=s.find((t=>{const{path:i}=t;return!!new RegExp(i).test(e)}));return o?{isNeed:!0,pathConfig:o}:{isNeed:!1,pathConfig:i}}addRequstParams(t,e,i={}){var r,s;const o=this.getRequestData(t,i);if(!o)return t;const{isNeed:a,pathConfig:n}=this.getNeedParsePath(t);if(!a)return t;const l=(null===(r=i.headers)||void 0===r?void 0:r["Content-Type"])||(null===(s=i.headers)||void 0===s?void 0:s["content-type"])||"",c=this.parseRequestParams(o,l),{includes:u=[],excludes:d=[],all:h}=n;let g={};return h?(g=c,t.requestParams=JSON.stringify(g),t):u.length>0?(u.forEach((t=>{void 0!==c[t]&&(g[t]=c[t])})),t.requestParams=JSON.stringify(g),t):d.length>0?(Object.keys(c).forEach((t=>{d.includes(t)||(g[t]=c[t])})),t.requestParams=JSON.stringify(g),t):(t.requestParams=JSON.stringify(g),t)}formatApiPath(t){const e=t.indexOf("/ltspc");return e>=0?t.slice(e):t.replace(g,"")}getPublicParams(t,e){const i={};let[r="",s=""]=e.url&&e.url.split("?")||[];const o=document.createElement("a");return o.href=r,r=o.pathname,i.apiPath=this.formatApiPath(r),this.customParam({obj:i,xhr:t,opts:e}),i.apiSearch=s,i.userAgent=navigator&&navigator.userAgent||"",i.page_name=window.getSaPageInfo&&window.getSaPageInfo.page_name||window.SaPageInfo&&window.SaPageInfo.page_name||"",i.status_code=t.status,i.cookieSize=document&&document.cookie&&document.cookie.length,i.hrefSize=location&&location.href&&location.href.length,i}customParam({obj:t,opts:e}){if(t.apiPath.indexOf("/unifiedPay")>-1){let i=e.data.split("&");i=i.filter((t=>t.indexOf("paymentCode")>-1)),i=i[0]&&i[0].split("=")||[];const r=i[1]||"";t.payment_code=r}}sendReport(t,e={},i={}){try{if(this.isFilterEnvs())return;const t=this.transformResponse(e);if(!this.isReportCode(t,e))return;const r=this.getPublicParams(e,i);if(this.isFilterRoute(i))return;if(!this.isIncluseRoutes(r.apiPath))return;if("undefined"==typeof sa)return;this.formatReportParams(r,t,e,i),this.report(r)}catch(t){o.log(t)}}sendReportForScHttp(t){this.sendReport(null,null==t?void 0:t.request,null==t?void 0:t.config)}report(t){try{if("undefined"==typeof sa)return;if(!n){const{SA_REPORT_URL:t}=gbCommonInfo.REPORT_URL;n=`${t}/orgSsaUnusual`}window.sa("error",n,t)}catch(t){o.log(t)}}}},348668:(t,e,i)=>{i.d(e,{iy:()=>o});var r=i(444736);const s=[["s","search"],["r","recommend"],["u","userGrowth"]],o=t=>{const e={},i=(()=>{const t=(0,r.R)("uswitch");let e;if(t){const i=decodeURIComponent(t).split(".").map((t=>t.split("-")));e=s.reduce(((t,e)=>{const r=i.find((([t,i])=>t===e[0]&&0==i));return t[e[1]]=r?0:1,t}),{})}return e})();return i&&Object.keys(i).length&&(e["uberctx-personal-switch"]=encodeURIComponent(JSON.stringify(i))),t.headers=Object.assign(e,t.headers),t}},404266:(t,e,i)=>{i.d(e,{lt:()=>v});var r=i(846825),s=i(794103),o=i(383112),a=i(415690),n=i(665640);const l=class{constructor(){(0,s.A)(this,"isSupportGeetest",!0),(0,s.A)(this,"isShouldInit",!1),(0,s.A)(this,"info",{}),(0,s.A)(this,"challange",""),(0,s.A)(this,"verifyCb",[]),(0,s.A)(this,"gtInstance",null),(0,s.A)(this,"from",""),(0,s.A)(this,"isReInitStatus",!1),(0,s.A)(this,"isGtInstanceReady",!1),(0,s.A)(this,"errorTriggerTimes",0),(0,s.A)(this,"reInitTimes",0),(0,s.A)(this,"riskMaskValue",""),(0,s.A)(this,"isResetting",!1),(0,s.A)(this,"chanllangeTimestap",0),(0,s.A)(this,"ajaxParams",""),(0,s.A)(this,"staticUrl",""),(0,s.A)(this,"fullpageJs","")}register(t,e=""){(0,o.A)({url:"/risk/verify/identity/geetest/register",timeout:2e4,method:"POST",data:{validate_type:e}}).then((i=>{var r;const{code:s,info:o}=i;if(this.fullpageJs=(null==o?void 0:o.fullpage)||"",this.staticUrl=(null==o||null===(r=o.static_servers)||void 0===r?void 0:r[0])||"",this.info=o,this.isShouldInit=0==s,this.isShouldInit)return this.chanllangeTimestap=Date.now(),void this.fetchFullPageResource(t,!!e);this.isReInitStatus&&(this.isReInitStatus=!1),"function"==typeof t&&t({status:"pass"})})).catch((e=>{this.errorReport(e,e.statusText,"/geetest/register"),this.isReInitStatus||"function"==typeof t&&t({status:"error"})}))}showInitGTinstance(){return!0}urlConversion(t){return t=t.replace(/^(https?:\/\/)([0-9a-z.]+)(:[0-9]+)?([/0-9a-z.]+)?(\?[0-9a-z&=]+)?(#[0-9-a-z]+)?/i,"https://$2$3$4$5$6")}fetchFullPageResource(t){if(!this.isShouldInit||!this.isSupportGeetest)return;if(1==this.isGtInstanceReady)return void this.initGeetestInstance(t);this.staticUrl=this.urlConversion(this.staticUrl);const e=`${this.staticUrl}/${this.fullpageJs}`;(0,a.t)({label:"script",attrs:{async:!0,src:e}}).then((()=>{this.initGeetestInstance(t)})).catch((e=>{n.log("fullpage.js error ......"),n.log(e),this.errorReport(e,"fullpage.js load error",""),"function"==typeof t&&t({status:"error"})}))}initGeetestInstance(t){const e={...this.info,product:"bind",lang:(i=gbCommonInfo.appLanguage,"pt-br"===i?"pt":"he"===i?"iw":i),next_width:"300px",timeout:2e4,pure:!0};var i;try{const i=new window.Geetest(e);i.onReady((()=>{this.isGtInstanceReady=!0,this.gtInstance=i,"function"==typeof t&&t({status:"complete"}),this.verifyCb.length>0&&this.gtInstance.verify()})),i.onSuccess((()=>{const{geetest_challenge:t}=i.getValidate();setTimeout((()=>{this.verifyCb.forEach((e=>{e({status:"success",challenge:t,risk:this.riskMaskValue}),this.verifyCb.shift()}))}),0)})),i.onClose((()=>{this.verifyCb.forEach((t=>{t({status:"close"}),this.verifyCb.shift()}))})),i.onError((e=>{n.log("error sdk ....",e),this.errorReport(e,"sdk error",""),"function"==typeof t&&t({status:"error"}),this.verifyCb.forEach((t=>{t({status:"error"}),this.verifyCb.shift()}))}))}catch(e){this.errorReport(e.stack,"sdk init error",""),"function"==typeof t&&t({status:"error"})}}verify(t,e=""){var i;n.log("reInitTimes",this.reInitTimes),!this.isGtInstanceReady||this.reInitTimes>=4?t({status:"error"}):(this.from=e,"function"==typeof t&&this.verifyCb.push(t),null===(i=this.gtInstance)||void 0===i||i.verify())}verifyPromise(t,e=""){return new Promise((t=>{this.verify((e=>{t(e)}),e)}))}recallVerfy(){this.isResetting&&this.verifyCb.length>0&&this.gtInstance.verify()}reset(){this.isResetting=!0,this.gtInstance.reset()}reInitGt(){this.reInitTimes>5||(this.reInitTimes++,this.isReInitStatus=!0)}errorReport(t,e,i){const r=t&&t.target?t.target:t;if("object"==typeof r&&("1021"==r.error_code||"1012"==r.error_code))return;this.errorTriggerTimes++;const{SA_REPORT_URL:s}="undefined"!=typeof gbCommonInfo&&gbCommonInfo.REPORT_URL||{};"undefined"!=typeof ErrorJs&&ErrorJs.sendError("error",s+"/unusual",{errorMark:"GeeTestBrowserError",errorType:e,errorInfo:JSON.stringify(r),errorPath:i,errrorTimes:this.errorTriggerTimes})}};var c=i(668484),u=i(112733),d=i(806365),h=i(177279),g=i(92525),p=i(665640);const m="_f_c_llbs_";async function f(t){const e=1==window.GB_RISK_CHALLEGE_LIMIT?new l:new r.A,i=(1==window.GB_RISK_CHALLEGE_LIMIT?{901:"gee_slide",902:"gee_click"}:{901:"slide",902:"icon"})[t]||"";if(!i){return{status:"geetest_error",msg:"captcha_type not support"}}const s=await function(t,e){return new Promise((i=>{e.register(i,t)}))}(i,e),{status:o}=s;if("error"==o){return{status:"geetest_error",msg:"geetest init error"}}const{status:a,challenge:n,risk:c}=await e.verifyPromise("","flow_challenge");if("close"==a){return{status:"geetest_close",msg:""}}if("error"==a){return{status:"geetest_error",msg:"geetest request error"}}return{status:"success",challenge:n,risk:c}}async function v(t,e,i){let r={},s="";if(![901,902,903,904,905,910,907,909].includes(Number(t)))return{status:"error",challenge:"",risk:""};try{const{"risk-id":t}=(0,d.J)(location.search);if(t){var n,l,v,y,_,I,w,b,k;null===(n=window)||void 0===n||n.sa("set","setPageData",window.SaPageInfo),null===(l=window)||void 0===l||l.sa("send","pageEnter",{start_time:(new Date).getTime()}),window.onbeforeunload=function(){var t;null===(t=window)||void 0===t||t.sa("send","pageLeave",{end_time:(new Date).getTime()})};const e=(null===(v=window)||void 0===v||null===(y=v.AntiIn)||void 0===y?void 0:y.syncGetAllEncrypted(null===(_=window)||void 0===_?void 0:_.AntiIn.Channel.PC))||null,i=encodeURIComponent(location.href),r=(null===(I=window)||void 0===I?void 0:I.__ArmorToken)||(null===(w=window)||void 0===w?void 0:w.sessionStorage.getItem("armorToken"))||(null===(b=window)||void 0===b?void 0:b.localStorage.getItem("armorToken"))||null;null===(k=window)||void 0===k||k.sa("send",{activity_name:"expose_risk_envinfo",activity_param:{origin_risk_id:t,anti_in:e,armortoken:r,risk_url:i}})}}catch(t){p.log("error",t)}switch(Number(t)){case 901:case 902:s="anti_crawler_gee",r=await f(t);break;case 907:return void function({captcha_type:t,cookie_duration:e,api_risk_id:i}){try{var r,s,o,a,n,l,c,u,d,m;if(null===h.JY||void 0===h.JY||h.JY.metricCount({metric_name:"anti_crawler_count",tags:{captcha_type:Number(t),cookie_duration:e||"no_cookie_duration",api_risk_id:i||"no_api_risk_id",href:null===(r=window)||void 0===r||null===(s=r.location)||void 0===s?void 0:s.href,site_uid:(null===(o=window)||void 0===o||null===(a=o.gbCommonInfo)||void 0===a?void 0:a.SiteUID)||"",hostname:null===(n=window)||void 0===n||null===(l=n.location)||void 0===l?void 0:l.hostname,pathname:null===(c=window)||void 0===c||null===(u=c.location)||void 0===u?void 0:u.pathname,memberId:(null===g.default||void 0===g.default?void 0:g.default.get({key:"memberId",actionType:"riskForceLogin"}))||"no_memberId"},message:"anti_crawler_count"},{immediate:!0}),window.location.href.includes("/user/auth/login"))return void p.log("Already on login page, no redirection needed");window.open(`${null===(d=gbCommonInfo)||void 0===d?void 0:d.host}${null===(m=gbCommonInfo)||void 0===m?void 0:m.langPath}/user/auth/login?redirection=${encodeURIComponent(window.location.href)}&activity_sign=crawler`,"_self")}catch(t){return p.log("error",t),{status:"error",challenge:"",risk:""}}}({captcha_type:t,cookie_duration:e,api_risk_id:i});default:s="anti_crawler_RT",r=await async function(t,e){var i,r,s,n,l,c,p,m,f,v,y,_,I,w;const{"risk-id":b}=(0,d.J)(location.search),k=(null===(i=window)||void 0===i||null===(r=i.gbCommonInfo)||void 0===r?void 0:r.RISK_SDK_TYPE)||{},S=Object.keys(k).length>0?k:{903:"js_challenge",904:"gee_slide",905:"gee_click",910:"nine_captcha",909:"one_pass"};var A,R;1==(null===(s=window)||void 0===s||null===(n=s.gbCommonInfo)||void 0===n?void 0:n.GB_RISK_JS_CHALLEGE)&&903==t&&e&&(null===(A=window)||void 0===A||null===(R=A.AntiDevices)||void 0===R||R.report("js_challenge")),u.default.init({axiosInstance:o.A,rate:5e3});const C=(null===(l=window)||void 0===l||null===(c=l.gbCommonInfo)||void 0===c||null===(p=c.RISK_SDK_CONFIG)||void 0===p||null===(m=p.spider)||void 0===m?void 0:m.siteuid)||[],E=(null===(f=window)||void 0===f||null===(v=f.gbCommonInfo)||void 0===v?void 0:v.SiteUID)||"";if(1==(null===(y=window)||void 0===y||null===(_=y.gbCommonInfo)||void 0===_||null===(I=_.RISK_SDK_CONFIG)||void 0===I||null===(w=I.spider)||void 0===w?void 0:w.xhr)||C.includes(E))try{var T,L,D,P,N,x,O,j,U;if(null===(T=window)||void 0===T||!T.AntiDevices)window._INCONF||(window._INCONF={appName:null===(P=window)||void 0===P||null===(N=P.gbCommonInfo)||void 0===N?void 0:N.WEB_CLIENT,apiHost:o.A?"":null===(x=window)||void 0===x||null===(O=x.gbCommonInfo)||void 0===O?void 0:O.langPath,channel:0,isOpenIntervalReport:!0,isOpenFeatureDector:(null===(j=window)||void 0===j||null===(U=j.gbCommonInfo)||void 0===U?void 0:U.IS_OPEN_FEATURE_DECTOR)||!1,schttp:o.A}),await(0,a.t)({label:"script",attrs:{async:!0,src:`${null===(L=window)||void 0===L||null===(D=L.gbCommonInfo)||void 0===D?void 0:D.ARMOR_CDN}/she_dist/armor-libs/infp/infp.3.9.0.min.js`}})}catch(i){var G,J,$,H,q,M,K,F;null===h.JY||void 0===h.JY||h.JY.metricCount({metric_name:"anti_crawler_armortoken",tags:{error:i||{},captcha_type:Number(t),api_risk_id:e||"no_api_risk_id",href:null===(G=window)||void 0===G||null===(J=G.location)||void 0===J?void 0:J.href,site_uid:(null===($=window)||void 0===$||null===(H=$.gbCommonInfo)||void 0===H?void 0:H.SiteUID)||"",hostname:null===(q=window)||void 0===q||null===(M=q.location)||void 0===M?void 0:M.hostname,pathname:null===(K=window)||void 0===K||null===(F=K.location)||void 0===F?void 0:F.pathname,memberId:(null===g.default||void 0===g.default?void 0:g.default.get({key:"memberId",actionType:"antiCrawlerArmortoken"}))||"no_memberId"},message:"anti_crawler_armortoken"},{immediate:!0})}const V={validate_type:S[t],validate_scene:"anti_crawler_RT",validate_channel:0,validate_param:{decision_id:e||b||""}};return new Promise((t=>{u.default.doVerify(V,(e=>{var i;const{isSuccess:r}=e;t({status:r?"success":"error",challenge:"",risk:"",validate_token:(null==e||null===(i=e.info)||void 0===i?void 0:i.validate_token)||""})})).catch((e=>{t({status:"error",challenge:"",risk:""})}))}))}(t,i)}const{status:S,challenge:A,risk:R,validate_token:C}=r;if("success"!=S)return r;const E={challenge:A,captcha_type:t,gRisk:R,validate_scene:s,validate_token:C||""},T=await(0,o.A)({url:"/api/risk/flow_check",method:"POST",data:E}).catch((t=>t)),L={status:0==T.status?"success":"risk_error",code:T.status,llbs:T.llbs||""};if(0==T.status){const t=parseInt(e)||0;(0,c.T)({key:m,value:T.llbs,end:2*t})}return L}},476934:(t,e,i)=>{i.d(e,{F:()=>o});var r=i(177279);const s=["/api/abt/userinfo/query","/api/common/language/get","/api/robot/match/query","/api/robot/dialog/get","/api/robot/match/multi/query","/api/robot/channel/check/query","/api/robot/common/template/query","/api/robot/theme/get","/api/robot/chat/check/query","/api/robot/gwotk/tax/create","/api/robot/gwotk/dulyDeliver/create","/api/robot/cstk/create","/api/robot/gwotk/create","/api/robot/gwotk/quality/create","/api/robot/cschat/token/get","/api/robot/cschat/end/delete","/api/robot/cschat/conversation/create","/api/robot/cschat/message/create","/api/robot/cschat/evaluation/create","/api/robot/cschat/messageReport/create","/api/productList/info/get","/api/cart/getIntegrityPromotionInfo/get","/api/cart/modifyCartCheckStatus/update","/api/cart/add_mall/create","/api/cart/update_attr_mall/update","/api/checkout/get","/api/pay/unifiedPay/create","/result/unifiedCb","/pay/result/success","/pay/result/fail","/api/user/dashboard/base/get","/api/user/addressbook/addressCheckRule/get","/api/user/addressbook/countrySensitiveList/query","/api/user/addressbook/storeConfigInfo/get","/api/user/addressbook/accountAndOrderEmail/get","/api/orders/base/queryAddressInfo/query","/api/user/addressbook/universalCountryList/get","/api/user/addressbook/addressFormConfigByInfo/get","/api/user/addressbook/limitAddr/query","/api/coupon/bindCouponPackage/update"];function o(t,{responseTime:e}){s.some((e=>e===t))&&r.JY.metricTime({metric_name:"web_request_duration",tags:{path:t},value:e},{random:.05})}},818356:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(177279),s=i(444736);const{SiteUID:o,xAdFlagObj:a}="undefined"!=typeof gbCommonInfo?gbCommonInfo:{};function n({originUrl:t,message:e,...i}){try{const n=new Error;r.Vc.logInfo({tag:"x_address_flag",params:{siteuid:o,memberId:(0,s.R)("memberId")||"",url:t,xAdFlag:(null==a?void 0:a.xAdFlag)||"",xAppId:(null==a?void 0:a.xAppId)||"",pathname:location.pathname,referer:document.referrer||"",ua:navigator.userAgent||"",stack:n.stack||"",...i},message:e})}catch(t){r.Vc.logInfo({tags:"x_address_flag_error",params:{error:t.message},message:"x address flag record error"})}}},846825:(t,e,i)=>{i.d(e,{A:()=>c});var r=i(794103),s=i(383112),o=i(415690),a=i(665640);const n={forgetPassword:"click_fpwordriskverify",forgetPhone:"click_fpwordriskverify",resetPhone:"click_fpwordriskverify",loginEmail:"click_loginriskverify",loginPhone:"click_loginriskverify",phoneCodeSend:"click_loginriskverify",signupEmail:"click_registerriskverify",signupPhone:"click_registerriskverify",quickRegister:"click_registerriskverify"},l=["JyRisk","JyRiskReg","JyRiskZTReg"];const c=class{constructor(){(0,r.A)(this,"abtResult",{}),(0,r.A)(this,"isSupportGeetest",!0),(0,r.A)(this,"isShouldInit",!1),(0,r.A)(this,"info",{}),(0,r.A)(this,"challange",""),(0,r.A)(this,"verifyCb",[]),(0,r.A)(this,"gtInstance",null),(0,r.A)(this,"from",""),(0,r.A)(this,"isReInitStatus",!1),(0,r.A)(this,"isGtInstanceReady",!1),(0,r.A)(this,"errorTriggerTimes",0),(0,r.A)(this,"reInitTimes",0),(0,r.A)(this,"riskMaskValue",""),(0,r.A)(this,"isResetting",!1),(0,r.A)(this,"isSetXhrListen",!1),(0,r.A)(this,"chanllangeTimestap",0),(0,r.A)(this,"ajaxParams",""),(0,r.A)(this,"staticUrl",""),(0,r.A)(this,"fullpageJs","")}register(t,e=""){(0,s.A)({url:`/geetest/register?riskType=${e}`,timeout:2e4}).then((i=>{var r;const{status:s,data:o}=i;if(this.fullpageJs=(null==o?void 0:o.fullpage)||"",this.staticUrl=(null==o||null===(r=o.static_servers)||void 0===r?void 0:r[0])||"",this.info=o,this.isShouldInit=0==s,this.isShouldInit)return this.chanllangeTimestap=Date.now(),this.listenXhrComplete(),void this.fetchFullPageResource(t,!!e);this.isReInitStatus&&(this.isReInitStatus=!1),"function"==typeof t&&t({status:"pass"})})).catch((e=>{this.errorReport(e,e.statusText,"/geetest/register"),this.isReInitStatus||"function"==typeof t&&t({status:"error"})}))}listenXhrComplete(){if(this.isSetXhrListen)return;this.isSetXhrListen=!0;const t=XMLHttpRequest.prototype.open,e=this;XMLHttpRequest.prototype.open=function(){let i=arguments;this.addEventListener("load",(function(){/geetest\/ajax\.php$/.test(this.responseURL)&&e.sendGtVerifyResult(this.responseText),/geetest\/reset\.php$/.test(this.responseURL)&&(e.chanllangeTimestap=Date.now(),e.recallVerfy(),e.isResetting=!1)})),this.addEventListener("error",(function(t){const r=i&&i[1];r&&/geetest\/(ajax|get|refresh|reset)\.php$/.test(r)&&(e.errorReport(t,"network error",r),e.isGtInstanceReady||"function"==typeof e.initCb&&e.initCb())})),this.addEventListener("timeout",(function(t){const r=i&&i[1];r&&/geetest\/(ajax|get|refresh|reset)\.php$/.test(r)&&(e.errorReport(t,"timeout",r),e.isGtInstanceReady||"function"==typeof e.initCb&&e.initCb())})),/geetest\/ajax\.php$/.test(i[1])&&(e.isSendingAjaxPhP=!0),t.apply(this,i)};const i=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){!0===e.isSendingAjaxPhP&&(e.ajaxParams=arguments[0],e.isSendingAjaxPhP=!1),i.apply(this,arguments)}}sendGtVerifyResult(t){let e={};try{e=JSON.parse(t)}catch(t){}const i=e.data||{};this.riskMaskValue=i&&i.risk;let r=1;0===e.status&&"success"===i.result&&"fullpage"===i.sub_type&&(r=0);const s=n[this.from];if(!this.from)return;const o="undefined"!=typeof SaPageInfo?SaPageInfo:{start_time:Date.now()},a={verification_result:r,sessionid_shein:e.token||""};i.sub_type&&(a.sub_type=i.sub_type),i.score&&(a.score=i.score),i.result&&(a.success="success"===i.result?0:1);const l=Object.assign({},o,{activity_name:s,activity_param:a});sa("send",l)}async getGtAbtResult(t){if(!this.isSupportGeetest)return"function"==typeof t&&t({status:"not_support"});this.initCb=t;try{let e={JyRisk:{param:"on",poskeys:"JyRisk"},JyRiskReg:{param:"on",poskeys:"JyRiskReg"},JyRiskZTReg:{param:"on",poskeys:"JyRiskZTReg"}};if(this.setAbtResult(e),this.showInitGTinstance())return void this.register(t)}catch(t){this.abtResult={}}this.isShoudInitGt=!1,"function"==typeof t&&t({status:"error"})}setAbtResult(t){l.forEach((e=>{this.abtResult[e]=t[e]||{}}))}getItemResult(t){return!(this.abtResult[t]&&"off"===this.abtResult[t].param)&&this.isShouldInit}showInitGTinstance(){return!0}urlConversion(t){return t=t.replace(/^(https?:\/\/)([0-9a-z.]+)(:[0-9]+)?([/0-9a-z.]+)?(\?[0-9a-z&=]+)?(#[0-9-a-z]+)?/i,"https://$2$3$4$5$6")}fetchFullPageResource(t){if(!this.isShouldInit||!this.isSupportGeetest)return;if(1==this.isGtInstanceReady)return void this.initGeetestInstance(t);this.staticUrl=this.urlConversion(this.staticUrl);const e=`${this.staticUrl}/${this.fullpageJs}`;(0,o.t)({label:"script",attrs:{async:!0,src:e}}).then((()=>{this.initGeetestInstance(t)})).catch((e=>{a.log("fullpage.js error ......"),a.log(e),this.errorReport(e,"fullpage.js load error",""),"function"==typeof t&&t({status:"error"})}))}initGeetestInstance(t){const e={...this.info,product:"bind",lang:(i=gbCommonInfo.appLanguage,"pt-br"===i?"pt":"he"===i?"iw":i),next_width:"300px",timeout:2e4,pure:!0};var i;try{const i=new window.Geetest(e);i.onReady((()=>{this.isGtInstanceReady=!0,this.gtInstance=i,"function"==typeof t&&t({status:"complete"}),this.verifyCb.length>0&&this.gtInstance.verify()})),i.onSuccess((()=>{const{geetest_challenge:t}=i.getValidate();setTimeout((()=>{this.verifyCb.forEach((e=>{e({status:"success",challenge:t,risk:this.riskMaskValue}),this.verifyCb.shift()}))}),0)})),i.onClose((()=>{this.verifyCb.forEach((t=>{t({status:"close"}),this.verifyCb.shift()}))})),i.onError((e=>{a.log("error sdk ....",e),this.errorReport(e,"sdk error",""),"function"==typeof t&&t({status:"error"}),this.verifyCb.forEach((t=>{t({status:"error"}),this.verifyCb.shift()}))}))}catch(e){this.errorReport(e.stack,"sdk init error",""),"function"==typeof t&&t({status:"error"})}}verify(t,e=""){var i;a.log("reInitTimes",this.reInitTimes),!this.isGtInstanceReady||this.reInitTimes>=4?t({status:"error"}):(this.from=e,"function"==typeof t&&this.verifyCb.push(t),null===(i=this.gtInstance)||void 0===i||i.verify())}verifyPromise(t,e=""){return new Promise((i=>{if(!this.getItemResult(t))return i({status:"abt-off"});this.verify((t=>{i(t)}),e)}))}recallVerfy(){this.isResetting&&this.verifyCb.length>0&&this.gtInstance.verify()}reset(){this.isResetting=!0,this.gtInstance.reset()}reInitGt(t){this.reInitTimes>5||(this.reInitTimes++,this.isReInitStatus=!0,this.getGtAbtResult(t))}errorReport(t,e,i){const r=t&&t.target?t.target:t;if("object"==typeof r&&("1021"==r.error_code||"1012"==r.error_code))return;this.errorTriggerTimes++;const{SA_REPORT_URL:s}="undefined"!=typeof gbCommonInfo&&gbCommonInfo.REPORT_URL||{};"undefined"!=typeof ErrorJs&&ErrorJs.sendError("error",s+"/unusual",{errorMark:"GeeTestBrowserError",errorType:e,errorInfo:JSON.stringify(r),errorPath:i,errrorTimes:this.errorTriggerTimes})}}},929819:(t,e,i)=>{i.d(e,{rC:()=>j,Uo:()=>U,JC:()=>J,QQ:()=>G});var r=i(290165),s=i(665640);function o(t,e=null){s.log(`%c [userActionTracker] %c ${t}`,"color: #fff; background: #6dc260;font-size: 10px; padding: 2px;","color: #333; background: #fff; font-size: 10px;padding: 2px;",e)}var a=i(665640);class n{constructor({saNames:t,singleKey:e,saNameDefaultLimit:i,handleAction:r,keepAlive:s}){this.saNameMap=this.initSaNameMap(t),this.saNameDefaultLimit=i||30,this.isStart=!1,this.sessionId=null,this.singleKey=e||!1,this.onWatch=()=>{},this.data={},this.onceData={},this.handleAction=r||(t=>t),s&&this.startCollect()}initSaNameMap(t=[]){if(!Array.isArray(t))return{list:[],moreNames:[]};const e=[],i=[];return t.forEach((t=>{"string"==typeof t&&(t={saName:t,limit:this.saNameDefaultLimit}),t.saName.includes(",")?e.push(t):i.push(t)})),{list:i,moreNames:e}}getData(){const t=this.onceData||{};if(Object.keys(t).length>0){const e=function(t,e){return Object.keys(t).reduce(((i,r)=>{i[r]=t[r];const s=e[r];if(!s)return i;const o=t[r]||{},a=Object.keys(s).reduce(((t,e)=>{const i=o[e]||[],r=s[e]||[],a=i.map((t=>{var e;return null==t||null===(e=t.activity_param)||void 0===e?void 0:e._actionId})).filter(Boolean);return t[e]=[...i,...r.filter((t=>!a.includes(t.id)))],t}),{});return i[r]={...o,...a},i}),{})}(this.data,t);return this.onceData={},this.handleExpireData(e)}return this.handleExpireData(this.data)}handleExpireData(t){return Object.keys(t).reduce(((e,i)=>{var r;const s=null===(r=t[i])||void 0===r?void 0:r._expireTimeList;return s?(e[i]=Object.keys(t[i]).reduce(((e,r)=>{const o=t[i][r]||[],a=s[r]||[];if(!a.length)return e[r]=o,e;const n=o.filter(((t,e)=>!a[e]||a[e]>Date.now()));return e[r]=n,e}),{}),e):(e[i]=t[i],e)}),{})}setInitData(t={}){this.data=Object.assign({},t);let e=Object.keys(this.data);0!==e.length&&(this.singleKey||(e=e.sort(((t,e)=>e-t))),this.sessionId=e[0],this.isStart=!0)}registerHandler({watch:t}){this.onWatch=t}startCollect({to:t,from:e}={}){this.isStart=!0,this.sessionId?this.singleKey||this.handleMoreSessionIdData({to:t,from:e}):this.sessionId=Date.now(),this.data[this.sessionId]||(this.data[this.sessionId]=t?{_routeData:{to:{query:t.query,params:t.params,path:t.path},from:{query:e.query,params:e.params,path:t.path}}}:{})}handleMoreSessionIdData({to:t,from:e}){var i,r,s;const o=Object.keys(this.data);if(!o.some((e=>{var i,r,s;return(null===(i=this.data[e])||void 0===i||null===(r=i._routeData)||void 0===r||null===(s=r.to)||void 0===s?void 0:s.path)===t.path})))return void(this.sessionId=Date.now());const a=o.sort(((t,e)=>e-t)),n=a[0];if((null===(i=this.data[n])||void 0===i||null===(r=i._routeData)||void 0===r||null===(s=r.to)||void 0===s?void 0:s.path)===t.path)return void(this.sessionId=n);const l=a.findIndex((e=>{var i,r,s;return(null===(i=this.data[e])||void 0===i||null===(r=i._routeData)||void 0===r||null===(s=r.to)||void 0===s?void 0:s.path)===t.path})),c=a[l],u=this.data[c];if(u._routeData.to.path===t.path&&u._routeData.from.path===e.path)this.sessionId=Date.now();else{this.sessionId=c;const t=a.slice(0,l+1).reduce(((t,e)=>(t[e]=this.data[e],t)),{});this.data=t}}endCollect(){this.isStart=!1,this.data={},this.onWatch(this.data)}getSaName(t){var e,i,r,s;if(!this.isStart||!(null!==(e=this.saNameMap)&&void 0!==e&&null!==(i=e.list)&&void 0!==i&&i.length||null!==(r=this.saNameMap)&&void 0!==r&&null!==(s=r.moreNames)&&void 0!==s&&s.length||null==t)&&t.activity_name)return{};return{saName:this.saNameMap.list.find((e=>e.saName===t.activity_name)),moreSaName:this.saNameMap.moreNames.find((e=>{var i,r;return null==e||null===(i=e.saName)||void 0===i||null===(r=i.split(","))||void 0===r?void 0:r.includes(t.activity_name)}))}}handleSaNameLimitData({saName:t,moreSaName:e}){const i=this.data[this.sessionId],r=({item:t})=>{if(!t)return;const e=t.limit||this.saNameDefaultLimit,r=i[t.saName]||[];r.length>=e&&r.shift()};[e,t].forEach((t=>r({item:t})))}trigger(t){var e;null!=t&&null!==(e=t.activity_param)&&void 0!==e&&e._userTrackDisable||this.handleSetData(t,this.data)}triggerCustomData(t){if(!t||"object"!=typeof t)return a.warn("triggerCustomData value must be an object"),!1;const e=this.data[this.sessionId];return!!e&&(e.customData=Object.assign({},e.customData||{},t),this.onWatch(this.data,t),!0)}onceSet(t={},{to:e,from:i}){!Object.keys(this.data||{}).length&&e&&i&&this.startCollect({to:e,from:i}),this.onceData[this.sessionId]||(this.onceData[this.sessionId]={});const r=Math.random().toString(36).slice(6);return t.id=r,this.handleSetData(t,this.onceData),r}handleSetData(t,e){const i=e[this.sessionId];if(!i)return;const{saName:r,moreSaName:s}=this.getSaName(t);if(!r&&!s)return!1;this.handleSaNameLimitData({saName:r,moreSaName:s});const{activity_name:o,activity_param:a,page_name:n,page_param:l,timestamp:c,end_time:u}=t,d=({saName:r,limitTime:s}={})=>{if(!r)return;i[r]||(i[r]=[]);const d={activity_name:o,activity_param:{...a||{},_actionId:null==a?void 0:a._actionId},page_param:Object.assign({},l),page_name:n,timestamp:c,end_time:u};t.id&&(d.id=t.id);const h=this.handleAction?this.handleAction(d,this.data,{result:e}):d,g=h&&i[r].push(h);if(s&&g){const t=Date.now()+s;e[this.sessionId]._expireTimeList||(e[this.sessionId]._expireTimeList={}),e[this.sessionId]._expireTimeList[r]||(e[this.sessionId]._expireTimeList[r]=[]),e[this.sessionId]._expireTimeList[r][g-1]=t}};[s,r].forEach((t=>d(t))),this.onWatch(e,t)}}class l{constructor({targetPaths:t,clearDataPaths:e,singleKey:i}){this.startState=!1,this.userRouterActions=[],this.targetPaths=t||[],this.clearDataPaths=e||[],this.singleKey=i||!1}getData(){return this.userRouterActions}setInitData(t){this.userRouterActions=Array.isArray(t)?t:[],this.startState=this.userRouterActions.length>0}trigger(t={},e={}){if(t.path===e.path)return;if(!this.onStartCallback)throw new Error("请注册开始回调");if(0===this.targetPaths.length)return;let i=this.userRouterActions;if(!this.singleKey){const t=Object.keys(this.userRouterActions).sort(((t,e)=>e-t));i=[this.userRouterActions[t[0]]]}i.some((i=>{var r,s;return(null==i||null===(r=i.to)||void 0===r?void 0:r.path)===(null==t?void 0:t.path)&&(null===(s=i.from)||void 0===s?void 0:s.path)===e.path}))||(this.onStart(t,e),this.recordRouterAction(t,e))}registerHandler({onStartCallback:t,onEndCallback:e,targetTriggerCallback:i,watch:r}){this.onStartCallback=t||(()=>{}),this.onEndCallback=e||(()=>{}),this.targetTriggerCallback=i||(()=>{}),this.onWatch=r||(()=>{})}onStart(t,e){if(this.startState)return;(this.isHitTargetRouter({to:t})||this.userRouterActions.length>0)&&(this.startState=!0,this.onStartCallback({to:t,from:e}))}isHitTargetRouter({to:t}){return this.targetPaths.some((e=>{if(e){return new RegExp(e).test(t.path)}return!1}))}onEnd(){this.startState=!1,this.onEndCallback(),this.userRouterActions=[],this.onWatch(this.userRouterActions)}recordRouterAction(t,e){if(!this.startState)return;const i={to:{path:t.path},from:{path:e.path}};this.userRouterActions.push(i),this.isEnd({to:t,from:e})?this.onEnd():(this.isHitTargetRouter({to:t})&&this.targetTriggerCallback({to:t,from:e}),this.onWatch(this.userRouterActions))}isEnd({to:t}){if(this.clearDataPaths.some((e=>{if(e){return new RegExp(e).test(t.path)}return!1})))return!0;if(0===this.userRouterActions.length)return!1;const{to:{path:e},from:{path:i}}=this.userRouterActions[0],r=`${e}_${i}`,s=`${i}_${e}`,o=this.userRouterActions.filter((t=>{const{to:{path:e},from:{path:i}}=t;return`${e}_${i}`===r})),a=this.userRouterActions.filter((t=>{const{to:{path:e},from:{path:i}}=t;return`${e}_${i}`===s}));return o.length===a.length}}class c{constructor({debug:t}){this.debug=t||!1,this.collectDataInstanceHandlers=[],this.routerActionInstanceHandlers=[]}registerHandler({key:t,collectDataInstance:e,routerActionInstance:i,localInitData:s}){const a=`action_track_${t}_collect`,n=`action_track_${t}_router`,l=(0,r.getSessionStorage)(n),c=(0,r.getSessionStorage)(a);if(c&&e.setInitData(c),l&&i.setInitData(l),Array.isArray(s)){c||e.startCollect();try{s.forEach((t=>{e.trigger(t)}))}catch(e){o(`[${t}]初始化数据失败`,e)}}e.registerHandler({watch:(e,i)=>{(0,r.setSessionStorage)({key:a,value:e}),this.debug&&o(`[${t}]收集数据发生变化`,e)}}),this.collectDataInstanceHandlers.push(e),i.registerHandler({onStartCallback:i=>{this.debug&&o(`[${t}]收集start`),e.startCollect(i)},onEndCallback:()=>{this.debug&&o(`[${t}]收集数据end，清空数据`),e.endCollect()},targetTriggerCallback:t=>{e.startCollect(t)},watch:e=>{(0,r.setSessionStorage)({key:n,value:e}),this.debug&&o(`[${t}]路由行为发生变化`,e)}}),this.routerActionInstanceHandlers.push(i),this.debug&&o(`[${t}]注册成功,初始化数据`,{collectData:e.getData(),routerAction:i.getData()})}triggerCollectDataHandlers(t){this.collectDataInstanceHandlers.forEach((e=>{e.trigger(t)}))}triggerRouterActionHandlers(t,e){this.routerActionInstanceHandlers.forEach((i=>{i.trigger(t,e)}))}}var u=i(665640);const d=(t=[])=>null!=t&&t.length?t[t.length-1]:void 0,h=(t=[],e=",")=>null!=t&&t.length?t.join(e):void 0,g=[/^\/daily-new\.html$/,/^\/coupon-product\.html$/,/^\/sellingpoint-(\d+)-(\d+)-.+\.html$/,/^\/.+-c-(\d+)\.html$/,/^\/((\w+)\/)?.+-sc-([A-Za-z0-9]+)\.html$/,/^\/pdsearch\/([^\/]+)\/?$/,/^\/([a-z]+-picks|romwe-[a-z]+|promo-discount)(-list-([a-zA-Z0-9]+))?\.html$/].map((t=>t.source)).join("|"),p={featureKey:"detailsRecommend",saNames:["click_attribute","click_sort","click_category","click_goods_list_label","expose_goods_list","page_view"],targetPaths:[g],clearDataPaths:[],handleAction(t){var e,i;return"page_view"===t.activity_name?"page_search"===t.page_name&&null!==(e=t.page_param)&&void 0!==e&&e.result_content?{result_content:null===(i=t.page_param)||void 0===i?void 0:i.result_content}:null:t},onTrigger({collectData:t,routerAction:e,getUserActionTracker:i}){var r,s;u.warn("detailsRecommend before",t,e);const o=[],a=[],n=[],l=[],c=[],g=[],p=[],m=[];let f=[],v={value:"",timestamp:0};Object.keys(t).forEach((e=>{var i,r,s,u,y,_,I,w,b,k;const{click_attribute:S=[],click_sort:A=[],click_category:R=[],click_goods_list_label:C=[],expose_goods_list:E=[],page_view:T=[],customData:L,_routeData:D={}}=t[e]||{},P=(null==D?void 0:D.to)||{},N=null==S?void 0:S.filter((t=>{var e;return null==t||null===(e=t.activity_param)||void 0===e?void 0:e.attribute_list})),x=null==S?void 0:S.filter((t=>{var e;return null==t||null===(e=t.activity_param)||void 0===e?void 0:e.price_range})),O=null===(i=d(N))||void 0===i||null===(r=i.activity_param)||void 0===r?void 0:r.attribute_list,j=null===(s=d(x))||void 0===s||null===(u=s.activity_param)||void 0===u?void 0:u.price_range;var U,G;(O&&o.push(h([e,O])),j&&a.push(h([e,j])),null!=A&&A.length)&&n.push(h([e,(null===(U=d(A))||void 0===U||null===(G=U.activity_param)||void 0===G?void 0:G.sort)||"0"]));const J=null===(y=P.path)||void 0===y?void 0:y.match(new RegExp("pdsearch/.+")),$=T.filter((t=>null==t?void 0:t.result_content));if(J){var H,q,M,K;const t=null==E||null===(H=E[0])||void 0===H||null===(q=H.activity_param)||void 0===q||null===(M=q.goods_list)||void 0===M||null===(K=M.split("`"))||void 0===K?void 0:K[0];t&&m.push(h([e,t]))}J&&null!==(_=d($))&&void 0!==_&&_.result_content&&l.push(h([e,d($).result_content],"`"));if((null===(I=P.query)||void 0===I?void 0:I.categoryJump)||"sbc"===(null===(w=P.query)||void 0===w?void 0:w.entranceType)){var F,V,B,z,W;const t=null==E||null===(F=E[0])||void 0===F||null===(V=F.activity_param)||void 0===V||null===(B=V.goods_list)||void 0===B||null===(z=B.split("`"))||void 0===z?void 0:z[0],i=null==E||null===(W=E[0])||void 0===W?void 0:W.timestamp;t&&c.push(h([e,t,i]))}var Y,X,Z,Q;null!=R&&R.length&&g.push(h([e,null===(Y=d(R))||void 0===Y||null===(X=Y.activity_param)||void 0===X?void 0:X.category_id]));null!=C&&C.length&&p.push(h([e,null===(Z=d(C))||void 0===Z||null===(Q=Z.activity_param)||void 0===Q?void 0:Q.label_id]));null!=L&&L.searchGoods&&(f=f.concat([{...L.searchGoods,session_id:e}])),null!=L&&null!==(b=L.rt_f_search_unrelated_goods)&&void 0!==b&&b.value&&(null==L||null===(k=L.rt_f_search_unrelated_goods)||void 0===k?void 0:k.timestamp)>v.timestamp&&(v=L.rt_f_search_unrelated_goods)})),null!==(r=f)&&void 0!==r&&r.length&&(f=(t=>{if(null==t||!t.length)return[];let e=[],i=0;const r=t.sort(((t,e)=>e.timestamp-t.timestamp));for(let t=0;t<r.length;t++){const{goodsIds:s,timestamp:o,session_id:a}=r[t]||{};if(!s||null==s||!s.length)continue;const n=s.slice(0,20-i),l=h(n);if(e.push(h([a,o,l],"`")),i+=n.length,20===i)break}return e})(f));const{top40ExposeGoodsList:y,top40ClickGoodsList:_,top40ClickCheckoutList:I,top40ClickAddCollectList:w,top40ClickAddBagList:b}=i("commonActions"),k={rec_ctx:{rt_ft_list_filter:h(o),rt_ft_list_price:h(a),rt_f_list_sort:h(n),rt_f_search_identifier:h(l,"`"),rt_f_list_top_goods:h(c),rt_f_list_category_id:h(g),rt_f_list_label_id:h(p),rt_f_search_top_goods:h(m),rt_f_search_top_goods_v2:h(f,"`"),rt_f_search_unrelated_goods:(null===(s=v)||void 0===s?void 0:s.value)||"",rt_f_user_impr_v2:y,rt_f_user_clk_v3:_,rt_f_user_order_v2:I,rt_f_user_fav_v2:w,rt_f_user_cart_v2:b}};return u.warn("detailsRecommend result",k),k}};var m=i(665640);const f="expose_goods_list,expose_module_goods_list,expose_auto_rcmd_info_flow,expose_auto_rcmd_goods_list",v="click_goods_list,click_module_goods_list,click_auto_rcmd_info_flow,click_auto_rcmd_goods_list",y="click_checkout",_="click_add_collect",I="click_add_bag",w=(t=[],e=",")=>null!=t&&t.length?t.join(e):void 0,b=(t=[])=>w(t.sort(((t,e)=>e.split(",")[1]-t.split(",")[1])).slice(0,40)),k=t=>/^\d+$/.test(t),S=(t,e,{getGoodsListArr:i,getGoodsId:r})=>{const{page_name:s,timestamp:o,activity_param:a}=e||{},n=i(a)||[];n.length&&n.forEach((e=>{const i=r(e);k(i)&&t.push(w([i,o,s]))}))},A=(t,e)=>t.reverse().reduce(((t,i)=>(S(t,i,{getGoodsListArr:t=>{var e;return null==t||null===(e=t.goods_list)||void 0===e?void 0:e.split(",")},getGoodsId:t=>null==t?void 0:t.split("`")[0]}),e&&S(t,i,{getGoodsListArr:t=>{var e,i,r;return null==t||null===(e=t.info_flow)||void 0===e||null===(i=e.split("`"))||void 0===i||null===(r=i[3])||void 0===r?void 0:r.split("|")},getGoodsId:t=>{var e;return null==t||null===(e=t.split("_"))||void 0===e?void 0:e[1]}}),t)),[]),R=[p,{featureKey:"commonActions",keepAlive:!0,singleKey:!0,closeSessionStorage:!1,saNames:[{saName:f,limit:20,limitTime:6e4},{saName:v,limit:40,limitTime:6e4},{saName:y,limit:40,limitTime:6e4},{saName:_,limit:40,limitTime:6e4},{saName:I,limit:40,limitTime:6e4}],handleAction(t){if(f.includes(t.activity_name)||v.includes(t.activity_name)||y.includes(t.activity_name)||_.includes(t.activity_name)||I.includes(t.activity_name)){var e;if(_.includes(t.activity_name))if("1"!==(null===(e=t.activity_param)||void 0===e?void 0:e.is_cancel))return null;return(t=>{var e,i,r,s;const{activity_name:o,page_name:a,timestamp:n,activity_param:l}=t||{},c=null==l||null===(e=l.goods_list)||void 0===e?void 0:e.split(","),u=null==l||null===(i=l.info_flow)||void 0===i||null===(r=i.split("`"))||void 0===r||null===(s=r[3])||void 0===s?void 0:s.split("|");return m.log("全局埋点收集 ========> ",`${o}`,{page_name:a,timestamp:n,goodsId:null!=c&&c.length?c.map((t=>k(t.split("`")[0])?t.split("`")[0]:"invalidGoodsId")):null!=u&&u.length?u.map((t=>k(t.split("_")[1])?t.split("_")[1]:"invalidGoodsId")):"noGoodsId"}),{activity_name:o,page_name:a,timestamp:n,activity_param:{goods_list:null==l?void 0:l.goods_list,info_flow:null==l?void 0:l.info_flow}}})(t)}return t},onTrigger({collectData:t}){const{[f]:e=[],[v]:i=[],[y]:r=[],[_]:s=[],[I]:o=[]}=t[Object.keys(t)[0]];return{top40ExposeGoodsList:b(A(e,!0)),top40ClickGoodsList:b(A(i,!0)),top40ClickCheckoutList:b(A(r)),top40ClickAddCollectList:b(A(s)),top40ClickAddBagList:b(A(o))}}}];var C=i(640593),E=i(544764),T=i.n(E);function L(t,e){return t.get(function(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}(t,e))}var D=new WeakMap;const P=class{constructor(){(0,C.A)(this,D,"s_router_history_data"),this.toData={},this.fromData={}}init(){const t=new(T())(window.location.search),e={};t.forEach(((t,i)=>{e[i]=t})),this.toData={historyLength:window.history.length,path:window.location.pathname,query:e};try{var i;const t=(0,r.getSessionStorage)(L(D,this))||{};((null==t?void 0:t.historyLength)||0)<this.toData.historyLength-1||(null==t?void 0:t.path)===(null===(i=this.toData)||void 0===i?void 0:i.path)?this.fromData={}:this.fromData=Object.assign({},t)}catch(t){}this.updateSessionStorage(),this.addEvent(),this.handleTrigger()}addEvent(){}updateSessionStorage(){(0,r.setSessionStorage)({key:L(D,this),value:this.toData})}handleTrigger(){this.handler&&this.handler(this.toData,this.fromData)}registerHandler(t){this.handler=t}};var N=i(665640);function x(t=[],{debug:e=!1}){const i=new c({debug:e});window.analysisBeforeInterceptor&&window.analysisBeforeInterceptor.use((async t=>{try{var e,r;i.triggerCollectDataHandlers(t.data),null!==(e=t.data)&&void 0!==e&&null!==(r=e.activity_param)&&void 0!==r&&r._actionId&&delete t.data.activity_param._actionId}catch(t){}return t}));const r=function(t=[]){function r(t){const r=new n(t),s=new l(t),o=function(t){const i=t.localDataConfig;if(!i)return null;const r="function"==typeof i.data?i.data():i.data;return r?Array.isArray(r)?r:(e&&N.warn("localDataConfig.data is not array or function"),null):null}(t);return i.registerHandler({key:t.featureKey,collectDataInstance:r,routerActionInstance:s,localInitData:o}),{collectDataInstance:r,routerActionInstance:s,localInitData:o}}const s={};return t.forEach((t=>{const{collectDataInstance:e,routerActionInstance:i,localInitData:o}=r(t);s[t.featureKey]={_:[],get:()=>t.onTrigger({collectData:e.getData(),routerAction:i.getData(),getUserActionTracker:(e,{origin:i=!1}={})=>{if(e===t.featureKey)return N.warn("can not call self"),null;if(s[t.featureKey]._.includes(e))return N.warn(`当前${t.featureKey}, 我被${e}调用过了，我不能再调用${e}`),null;const r=s[e];return r?(r._.push(t.featureKey),i?r.getOrigin():r.get()):null},localInitData:o}),set(t,r){"collectData"===t?e.trigger(r):"routerAction"===t?i.trigger(r):"customData"===t&&e.triggerCustomData(r)},onceSet(t,{to:i,from:r}){e.onceSet(t,{to:i,from:r})},startCollect(t){i.onStart(t.to,t.from)}}})),s}(t);return{trackingController:i,instances:r}}let O=null;function j(){var t;if("undefined"==typeof window||"1"==(null===(t=gbCommonInfo)||void 0===t?void 0:t.USER_ACTION_CLOSE))return;const e="1"==(0,r.getLocalStorage)("user_action_log")||window.location.href.includes("local-us.shein.com"),{instances:i,trackingController:s}=x(R,{debug:e});O=i,window._userActionTracker=O;const o=new P;o.registerHandler(((t,e)=>{try{s.triggerRouterActionHandlers({path:t.path,query:t.query},{path:e.path,query:e.query})}catch(t){N.error(t)}})),o.init()}function U(t){if(!O)return null;const e=O[t];return e?e.get():void 0}function G(t,e){if(!O)return;const i=O[t];i&&e&&i.set("collectData",e)}function J(t,e){if(!O)return;const i=O[t];i&&e&&i.set("customData",e)}}}]);
//# sourceMappingURL=52866-bfd711da1af3052b.js.map